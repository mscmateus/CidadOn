<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="../css/estilo.css">
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6hGq5B1bTduHlMSce0J16l0XPNtqEySo"></script>
<script type="text/javascript">
	var map, infoWindow, ufac = { lat : -9.954090, lng : -67.863422 }, cordenadasAtual, marca=null,descricaoAtual="";
	var tiposDeProblemas = [
		{titulo : "iluminação pública", descricao : "problemas de iluminção", icone : '/home/mateus/CidadOn/web/imagens/iluminacaoPublica.svg'},
		{titulo : "infraestrutura rodoviária", descricao :"buracos",icone : '/home/mateus/CidadOn/web/imagens/estruturaViaria.svg'},
		{titulo : "rede elétrica", descricao :"falta de luz",icone : '/home/mateus/CidadOn/web/imagens/redeEletrica.svg'},
		{titulo : "rede de esgoto", descricao : "esgoto vazando",icone : '/home/mateus/CidadOn/web/imagens/redeEsgoto.svg'},
		{titulo : "rede de distribuição de água", descricao : "falta de agua",icone : '/home/mateus/CidadOn/web/imagens/redeDistribuicaoAgua.svg'}
	];
	function carregaTiposDeProblema(){
		var select = document.getElementById('tipoProblema');
		for(var i=0; i<5; i++){
			var option = document.createElement('option');
			option.value = tiposDeProblemas[i].titulo;
			option.text = tiposDeProblemas[i].titulo;
			select.add(option);
		}
		trocaDescricaoProblema(determinaProblemaSelecionado());
	}

	function trocaDescricaoProblema(problema){
		var paragrafo = document.getElementById('descricaoProblema').innerHTML= problema.descricao;
	}

	function determinaProblemaSelecionado(value){
		var select = document.getElementById('tipoProblema');
		for(var i=0;i<5;i++){
			var option = select.options[i];
			if(option.selected == true){
				for(var j=0;j<5;j++){
					if(option.value==tiposDeProblemas[j].titulo){
							return tiposDeProblemas[j];
						break;
					}
				}
				break;
			}
		}
	}

	function trocaIcone(problema){
		trocaDescricaoProblema(problema);
		marca.setIcon(problema.icone);
	}




	function initMap(){
		var mapOptions = { center : new google.maps.LatLng(-9.954090, -67.863422), zoom : 16, mapTypeId : google.maps.MapTypeId.ROADMAP };
		map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
		map.addListener('click', function(e) {
			if(marca==null){
				fazPontoNoMapa(e.latLng);
			}else{
				marca.setMap(null);
				marca=null;
				fazPontoNoMapa(e.latLng);
			}
		});
	}
	infoWindow = new google.maps.InfoWindow;

	function geolocalization() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				var pos = { lat : position.coords.latitude, lng : position.coords.longitude };

				infoWindow.setPosition(pos);
				infoWindow.setContent('Location found.');
				infoWindow.open(map);
				map.setCenter(pos);
			}, function() {
				handleLocationError(true, infoWindow, map.getCenter());
			});
		} else {
			// Browser doesn't support Geolocation
			handleLocationError(false, infoWindow, map.getCenter());
		}
	}
	//
	function handleLocationError(browserHasGeolocation, infoWindow, pos) {
		infoWindow.setPosition(pos);
		infoWindow.setContent(browserHasGeolocation ? 'Erro: O serviço de golocalização falhou :(.': 'Seu navegador não suporta geolocalização..');
		infoWindow.open(map);
	}
	//cria um ponto no mapa
	function fazPonto(ponto) {
		marca = new google.maps.Marker({ position : ponto,icon : determinaProblemaSelecionado().icone, map : map });
		mostraCordenadas(ponto);
		cordenadasAtual = ponto;
	}
	//faz pontos no mapa apartir do click  e o centraliza no mapa
	function fazPontoNoMapa(latLng) {
				fazPonto(latLng);
				map.panTo(latLng);
	}
</script>
</head>
<body>
	<header id="opcoes">
		<h1>CidadON</h1>
	</header>
	<div id="opcoes">
		<header id="marreta">
		</header>
			<div id="conteudo">
				<form method="post">
					<h1 id="tituloAba">Cadastro de problema</h1>
					<table>
						<tr>
							<td>
								tipo de problema:
							</td>
							<td>
								<select id="tipoProblema" onchange="trocaIcone(determinaProblemaSelecionado());" style="width:150px;">
								</select>
							</td>
						</tr>
					</table>
					<p id="descricaoProblema"></p>
					<textarea cols="35" maxlength="210" style="resize: none" rows="6"></textarea>
					<center>
						<input id="botaoCadastro" type="submit" value="cadastrar" />
					</center>
				</form>
			</div>
		<footer id="rodape">
			<p>
				Copyright &copy; 2018 - by Argos Software<br>powered by Google maps
			</p>
		</footer>
	</div>
	<div id="map_canvas">
		<script type="text/javascript">
		initMap();
		geolocalization();
		carregaTiposDeProblema();

		</script>
	</div>
</body>
</html>
